<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Quiz Tonic</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #a8c0ff, #3f87a6);
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #fff;
        overflow: hidden;
        flex-direction: column;
        touch-action: none;
        -webkit-user-select: none;
        user-select: none;
      }

      h1 {
        font-size: 3em;
        font-weight: 700;
        text-transform: uppercase;
        text-shadow: 3px 3px 15px rgba(0, 0, 0, 0.2);
        margin-bottom: 40px;
        text-align: center;
        letter-spacing: 3px;
        position: relative;
        z-index: 10;
      }

      #fingerContainer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.2);
        z-index: 5;
      }

      .finger {
        width: 120px;
        height: 120px;
        background: linear-gradient(45deg, #ff5f6d, #ffc3a0);
        border-radius: 50%;
        position: absolute;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        transform: translate(-50%, -50%);
      }

      .chosen {
        background: linear-gradient(45deg, #cd3c15, #eb0303);
        box-shadow: 0 0 25px rgba(255, 0, 0, 0.8);
        transform: translate(-50%, -50%) scale(1.3);
      }

      button {
        padding: 15px 40px;
        font-size: 1.3em;
        background-color: #4caf50;
        border: none;
        border-radius: 50px;
        color: white;
        cursor: pointer;
        font-weight: 700;
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        text-transform: uppercase;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        z-index: 10;
      }

      #activiteDisplay {
        position: fixed;
        top: 120px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        padding: 15px 30px;
        border-radius: 10px;
        font-size: 1.5em;
        text-align: center;
        z-index: 20;
        max-width: 80%;
        display: none;
      }
    </style>
  </head>
  <body>
    <h1>Quiz Tonic</h1>
    <div id="fingerContainer"></div>
    <div id="activiteDisplay"></div>
    <button onclick="window.location.reload();">Recommencer</button>

    <script>
      // Liste des activités
      const activitémax = [
        "telephone arabe",
        "figure accrosport",
        "As tu déjà ri du malheur de quelqu'un ?",
        "As tu déjà vomis dans un lieu public ?",
        "Meilleur anecdote de soirée",
        "Meilleur anecdote au bassin a flot",
        "Meilleur anecdote avec un bureau",
        "Meilleur anecdote avec un vélo",
        "Meilleur anecdote avec un bateau",
      ];

      const activité1 = [
        "roulade",
        "pompe à une main",
        "fait le poirier",
        "pictionnary",
        "invente une danse",
        "raconte une histoire avec une voix aigue",
        "speech sur un objet banal",
        "présente la météo",
        "envoie un selfi ridicule à tes parents",
        "essaye de faire un tour de magie",
        "karaoké",
        "imite une personne autour de toi",
        "Quelle est ton talent chaché",
        "Quelle est le plat que tu as raté en cuisine",
        "Quelle est le cadeau le plus bizarre que tu es reçu",
        "Quelle est la pire mode que tu est suivi",
        "traverse la salle les yeux bander",
      ];

      const activité2 = [
        "invente ta rencontre avec une personne",
        "decris quelqu'un en 3 adjectif",
        "pompe avec une personne sur le dos",
        "course de chaise",
        "course de brouette",
        "concours de regard",
        "lire les message avec une personne",
        "fais une chason sur une personne",
        "reproduit la scene du titanic",
        "reproduit le portée de Dirty Dancing",
        "Changer de chaussures",
      ];

      // Variables globales
      const fingerContainer = document.getElementById("fingerContainer");
      const activiteDisplay = document.getElementById("activiteDisplay");
      let isSelecting = false;
      let selectionTimeout = null;

      // Utiliser un simple tableau pour stocker les éléments de doigt
      // Cette approche est plus simple et plus fiable
      const fingerElements = [];

      // Bloquer les événements par défaut pour le conteneur
      fingerContainer.addEventListener(
        "touchstart",
        function (e) {
          e.preventDefault();
          if (isSelecting) return;

          // Nettoyer les doigts existants si c'est un nouveau toucher après une pause
          if (fingerElements.length === 0) {
            clearTimeout(selectionTimeout);
          }

          // Ajouter de nouveaux doigts
          for (let i = 0; i < e.touches.length; i++) {
            const touch = e.touches[i];

            // Vérifier si ce doigt existe déjà
            let exists = false;
            for (let j = 0; j < fingerElements.length; j++) {
              if (fingerElements[j].touchId === touch.identifier) {
                exists = true;
                break;
              }
            }

            // Si le doigt n'existe pas encore, l'ajouter
            if (!exists) {
              addFinger(touch);
            }
          }

          // Démarrer le minuteur
          clearTimeout(selectionTimeout);
          selectionTimeout = setTimeout(selectFingers, 1500);
        },
        { passive: false }
      );

      // Gérer les mouvements des doigts
      fingerContainer.addEventListener(
        "touchmove",
        function (e) {
          e.preventDefault();
          if (isSelecting) return;

          // Mettre à jour les positions
          for (let i = 0; i < e.touches.length; i++) {
            const touch = e.touches[i];
            updateFingerPosition(touch);
          }
        },
        { passive: false }
      );

      // Gérer la fin du toucher
      fingerContainer.addEventListener(
        "touchend",
        function (e) {
          e.preventDefault();
          if (isSelecting) return;

          // Supprimer les doigts qui ont été levés
          for (let i = 0; i < e.changedTouches.length; i++) {
            const touch = e.changedTouches[i];
            removeFinger(touch.identifier);
          }

          // Si tous les doigts sont partis, annuler la sélection
          if (fingerElements.length === 0) {
            clearTimeout(selectionTimeout);
          }
        },
        { passive: false }
      );

      // Même chose pour touchcancel
      fingerContainer.addEventListener(
        "touchcancel",
        function (e) {
          e.preventDefault();
          if (isSelecting) return;

          for (let i = 0; i < e.changedTouches.length; i++) {
            const touch = e.changedTouches[i];
            removeFinger(touch.identifier);
          }

          if (fingerElements.length === 0) {
            clearTimeout(selectionTimeout);
          }
        },
        { passive: false }
      );

      // Ajouter un nouvel élément de doigt
      function addFinger(touch) {
        const fingerElement = document.createElement("div");
        fingerElement.classList.add("finger");
        fingerElement.style.left = touch.clientX + "px";
        fingerElement.style.top = touch.clientY + "px";
        fingerElement.touchId = touch.identifier;

        fingerContainer.appendChild(fingerElement);
        fingerElements.push(fingerElement);
      }

      // Mettre à jour la position d'un doigt existant
      function updateFingerPosition(touch) {
        for (let i = 0; i < fingerElements.length; i++) {
          if (fingerElements[i].touchId === touch.identifier) {
            fingerElements[i].style.left = touch.clientX + "px";
            fingerElements[i].style.top = touch.clientY + "px";
            break;
          }
        }
      }

      // Supprimer un doigt
      function removeFinger(touchId) {
        for (let i = 0; i < fingerElements.length; i++) {
          if (fingerElements[i].touchId === touchId) {
            fingerContainer.removeChild(fingerElements[i]);
            fingerElements.splice(i, 1);
            return;
          }
        }
      }

      // Sélectionner des doigts et afficher l'activité
      function selectFingers() {
        if (fingerElements.length === 0 || isSelecting) return;
        isSelecting = true;

        // Choisir une activité
        const phrase = choisirPhrase();
        const nombreDoigts = doigt(phrase);

        // Réinitialiser toutes les sélections
        for (let i = 0; i < fingerElements.length; i++) {
          fingerElements[i].classList.remove("chosen");
        }

        // Choisir des doigts aléatoires à sélectionner
        let chosenCount = Math.min(nombreDoigts, fingerElements.length);
        let indices = [];

        // Si on a besoin de tous les doigts ou plus, on les prend tous
        if (chosenCount >= fingerElements.length) {
          for (let i = 0; i < fingerElements.length; i++) {
            indices.push(i);
          }
        } else {
          // Sinon, on sélectionne aléatoirement
          while (indices.length < chosenCount) {
            const randomIndex = Math.floor(
              Math.random() * fingerElements.length
            );
            if (!indices.includes(randomIndex)) {
              indices.push(randomIndex);
            }
          }
        }

        // Appliquer la classe "chosen"
        for (let i = 0; i < indices.length; i++) {
          fingerElements[indices[i]].classList.add("chosen");
        }

        // Afficher l'activité
        activiteDisplay.textContent = phrase;
        activiteDisplay.style.display = "block";

        // Réinitialiser après un délai
        setTimeout(function () {
          isSelecting = false;
          activiteDisplay.style.display = "none";

          // Supprimer tous les cercles
          while (fingerElements.length > 0) {
            fingerContainer.removeChild(fingerElements[0]);
            fingerElements.shift();
          }
        }, 5000);
      }

      // Choisir une phrase aléatoire
      function choisirPhrase() {
        const allActivities = [...activitémax, ...activité1, ...activité2];
        const randomIndex = Math.floor(Math.random() * allActivities.length);
        return allActivities[randomIndex];
      }

      // Déterminer le nombre de doigts requis pour une activité
      function doigt(activite) {
        if (activitémax.includes(activite)) return fingerElements.length;
        if (activité1.includes(activite)) return 1;
        if (activité2.includes(activite)) return 2;
        return 1;
      }
    </script>
  </body>
</html>
