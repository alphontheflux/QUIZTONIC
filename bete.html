<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Quiz Tonic</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #a8c0ff, #3f87a6);
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #fff;
        overflow: hidden;
        flex-direction: column;
        touch-action: none;
        -webkit-user-select: none;
        user-select: none;
      }

      h1 {
        font-size: 3em;
        font-weight: 700;
        text-transform: uppercase;
        text-shadow: 3px 3px 15px rgba(0, 0, 0, 0.2);
        margin-bottom: 40px;
        text-align: center;
        letter-spacing: 3px;
        position: relative;
        z-index: 10;
      }

      #fingerContainer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.1);
        touch-action: none;
        z-index: 5;
      }

      .finger {
        width: 120px;
        height: 120px;
        background: linear-gradient(45deg, #ff5f6d, #ffc3a0);
        border-radius: 50%;
        position: absolute;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        transform: translate(-50%, -50%);
        will-change: transform, left, top;
      }

      .chosen {
        background: linear-gradient(45deg, #cd3c15, #eb0303);
        box-shadow: 0 0 25px rgba(255, 0, 0, 0.8);
        transform: translate(-50%, -50%) scale(1.3);
      }

      button {
        padding: 15px 40px;
        font-size: 1.3em;
        background-color: #4caf50;
        border: none;
        border-radius: 50px;
        color: white;
        cursor: pointer;
        font-weight: 700;
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        text-transform: uppercase;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        z-index: 10;
        -webkit-tap-highlight-color: transparent;
      }

      button:active {
        transform: translateX(-50%) scale(0.95);
      }

      #activiteDisplay {
        position: fixed;
        top: 120px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        padding: 15px 30px;
        border-radius: 10px;
        font-size: 1.5em;
        text-align: center;
        z-index: 20;
        max-width: 80%;
        display: none;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      #activiteDisplay.visible {
        opacity: 1;
      }

      #countdown {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 8em;
        z-index: 30;
        display: none;
        text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      }
    </style>
  </head>
  <body>
    <h1>Quiz Tonic</h1>
    <div id="fingerContainer"></div>
    <div id="activiteDisplay"></div>
    <div id="countdown"></div>
    <button onclick="resetGame()">Recommencer</button>

    <script>
      // Listes d'activités
      const activitémax = [
        "telephone arabe",
        "figure accrosport",
        "As tu déjà ri du malheur de quelqu'un ?",
        "As tu déjà vomis dans un lieu public ?",
        "Meilleur anecdote de soirée",
        "Meilleur anecdote au bassin a flot",
        "Meilleur anecdote avec un bureau",
        "Meilleur anecdote avec un vélo",
        "Meilleur anecdote avec un bateau",
      ];

      const activité1 = [
        "roulade",
        "pompe à une main",
        "fait le poirier",
        "pictionnary",
        "invente une danse",
        "raconte une histoire avec une voix aigue",
        "speech sur un objet banal",
        "présente la météo",
        "envoie un selfi ridicule à tes parents",
        "essaye de faire un tour de magie",
        "karaoké",
        "imite une personne autour de toi",
        "Quelle est ton talent chaché",
        "Quelle est le plat que tu as raté en cuisine",
        "Quelle est le cadeau le plus bizarre que tu es reçu",
        "Quelle est la pire mode que tu est suivi",
        "traverse la salle les yeux bander",
      ];

      const activité2 = [
        "invente ta rencontre avec une personne",
        "decris quelqu'un en 3 adjectif",
        "pompe avec une personne sur le dos",
        "course de chaise",
        "course de brouette",
        "concours de regard",
        "lire les message avec une personne",
        "fais une chason sur une personne",
        "reproduit la scene du titanic",
        "reproduit le portée de Dirty Dancing",
        "Changer de chaussures",
      ];

      // Éléments DOM
      const fingerContainer = document.getElementById("fingerContainer");
      const activiteDisplay = document.getElementById("activiteDisplay");
      const countdownElement = document.getElementById("countdown");

      // Variables d'état
      const fingers = new Map();
      let isSelecting = false;
      let isGameActive = true;
      let selectionTimeout = null;
      let resetTimeout = null;

      // Initialiser l'application
      initApp();

      function initApp() {
        // Empêcher les comportements par défaut du navigateur sur mobile
        document.addEventListener("touchstart", preventDefault, {
          passive: false,
        });
        document.addEventListener("touchmove", preventDefault, {
          passive: false,
        });

        // Ajouter les écouteurs d'événements pour le conteneur de doigts
        fingerContainer.addEventListener("touchstart", handleTouchStart, {
          passive: false,
        });
        fingerContainer.addEventListener("touchmove", handleTouchMove, {
          passive: false,
        });
        fingerContainer.addEventListener("touchend", handleTouchEnd, {
          passive: false,
        });
        fingerContainer.addEventListener("touchcancel", handleTouchEnd, {
          passive: false,
        });
      }

      function preventDefault(e) {
        if (e.target === fingerContainer) {
          e.preventDefault();
        }
      }

      function handleTouchStart(e) {
        e.preventDefault();
        if (!isGameActive || isSelecting) return;

        // Traiter chaque toucher
        for (let i = 0; i < e.changedTouches.length; i++) {
          const touch = e.changedTouches[i];
          createOrUpdateFinger(touch);
        }

        // Réinitialiser le minuteur de sélection
        clearTimeout(selectionTimeout);
        if (fingers.size >= 1) {
          selectionTimeout = setTimeout(startSelection, 1500);
        }
      }

      function handleTouchMove(e) {
        e.preventDefault();
        if (!isGameActive || isSelecting) return;

        // Mettre à jour la position de chaque doigt
        for (let i = 0; i < e.changedTouches.length; i++) {
          const touch = e.changedTouches[i];
          createOrUpdateFinger(touch);
        }
      }

      function handleTouchEnd(e) {
        e.preventDefault();
        if (!isGameActive) return;

        // Supprimer les doigts qui ne sont plus en contact
        for (let i = 0; i < e.changedTouches.length; i++) {
          const touch = e.changedTouches[i];
          removeFinger(touch.identifier);
        }

        // Si tous les doigts sont retirés et pas en mode sélection, annuler le compte à rebours
        if (fingers.size === 0 && !isSelecting) {
          clearTimeout(selectionTimeout);
        }
      }

      function createOrUpdateFinger(touch) {
        const id = touch.identifier;

        // Vérifier si le doigt existe déjà
        if (!fingers.has(id)) {
          // Créer un nouvel élément de doigt
          const finger = document.createElement("div");
          finger.classList.add("finger");
          fingerContainer.appendChild(finger);
          fingers.set(id, finger);
        }

        // Mettre à jour la position
        const finger = fingers.get(id);
        finger.style.left = `${touch.clientX}px`;
        finger.style.top = `${touch.clientY}px`;
      }

      function removeFinger(id) {
        const finger = fingers.get(id);
        if (finger) {
          finger.remove();
          fingers.delete(id);
        }
      }

      function startSelection() {
        if (fingers.size === 0 || isSelecting) return;
        isSelecting = true;

        // Afficher un décompte
        showCountdown(() => {
          // Choisir et afficher l'activité
          const phrase = choisirPhrase();
          const nombreDoigts = doigt(phrase);

          // Sélectionner les doigts
          selectFingers(nombreDoigts);

          // Afficher l'activité
          displayActivite(phrase);

          // Configurer la réinitialisation automatique
          resetTimeout = setTimeout(() => {
            resetGameState();
          }, 5000);
        });
      }

      function showCountdown(callback) {
        const countdown = document.getElementById("countdown");
        countdown.style.display = "block";
        countdown.textContent = "3";

        setTimeout(() => {
          countdown.textContent = "2";
          setTimeout(() => {
            countdown.textContent = "1";
            setTimeout(() => {
              countdown.style.display = "none";
              if (callback) callback();
            }, 800);
          }, 800);
        }, 800);
      }

      function selectFingers(nombreDoigts) {
        // Convertir la Map en tableau pour la sélection aléatoire
        const fingerElements = Array.from(fingers.values());

        // Déterminer combien de doigts sélectionner
        const numToSelect = Math.min(nombreDoigts, fingerElements.length);

        // Sélection aléatoire
        const selectedIndices = [];
        while (selectedIndices.length < numToSelect) {
          const randomIndex = Math.floor(Math.random() * fingerElements.length);
          if (!selectedIndices.includes(randomIndex)) {
            selectedIndices.push(randomIndex);
          }
        }

        // Appliquer la classe "chosen"
        for (let i = 0; i < fingerElements.length; i++) {
          if (selectedIndices.includes(i)) {
            fingerElements[i].classList.add("chosen");
          }
        }
      }

      function displayActivite(phrase) {
        activiteDisplay.textContent = phrase;
        activiteDisplay.style.display = "block";

        // Animation d'apparition
        setTimeout(() => {
          activiteDisplay.classList.add("visible");
        }, 10);
      }

      function choisirPhrase() {
        const allActivities = [...activitémax, ...activité1, ...activité2];
        const randomIndex = Math.floor(Math.random() * allActivities.length);
        return allActivities[randomIndex];
      }

      function doigt(activite) {
        if (activitémax.includes(activite)) return fingers.size; // Tous les doigts
        if (activité1.includes(activite)) return 1; // Un doigt
        if (activité2.includes(activite)) return 2; // Deux doigts
        return 1; // Par défaut
      }

      function resetGameState() {
        // Cacher l'activité
        activiteDisplay.classList.remove("visible");
        setTimeout(() => {
          activiteDisplay.style.display = "none";
        }, 300);

        // Supprimer tous les doigts
        fingers.forEach((finger) => finger.remove());
        fingers.clear();

        // Réinitialiser les états
        isSelecting = false;
        isGameActive = true;
      }

      function resetGame() {
        // Annuler tous les minuteurs
        clearTimeout(selectionTimeout);
        clearTimeout(resetTimeout);

        // Réinitialiser l'état du jeu
        resetGameState();
      }
    </script>
  </body>
</html>
