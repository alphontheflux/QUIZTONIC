<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz Tonic</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #a8c0ff, #3f87a6);
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #fff;
        overflow: hidden;
        flex-direction: column;
      }

      h1 {
        font-size: 3em;
        font-weight: 700;
        text-transform: uppercase;
        text-shadow: 3px 3px 15px rgba(0, 0, 0, 0.2);
        margin-bottom: 40px;
        text-align: center;
        letter-spacing: 3px;
      }

      /* Zone de toucher qui prend tout l'écran */
      #fingerContainer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 0;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
        touch-action: none;
      }

      .finger {
        width: 120px;
        height: 120px;
        background: linear-gradient(45deg, #ff5f6d, #ffc3a0);
        color: white;
        text-align: center;
        line-height: 90px;
        border-radius: 50%;
        font-size: 24px;
        position: absolute;
        transition: all 0.3s ease-in-out;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        z-index: 10;
      }

      .finger.shrink {
        width: 80px;
        height: 80px;
        line-height: 70px;
      }

      .chosen {
        background: linear-gradient(45deg, #cd3c15, #eb0303);
        color: #c8df45;
        box-shadow: 0 0 25px rgba(255, 0, 0, 0.8);
        width: 120px;
        height: 120px;
        line-height: 120px;
        transform: scale(1.3);
        transition: all 0.5s ease-in-out;
      }

      #selectedActivity {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        padding: 15px 30px;
        border-radius: 10px;
        font-size: 1.5em;
        text-align: center;
        max-width: 80%;
        z-index: 100;
        display: none;
      }

      button {
        padding: 15px 40px;
        font-size: 1.3em;
        background-color: #ff5f6d;
        border: none;
        border-radius: 50px;
        color: white;
        cursor: pointer;
        font-weight: 700;
        transition: all 0.3s ease;
        position: absolute;
        bottom: 20px; /* Placer le bouton au bas de l'écran */
        left: 50%;
        transform: translateX(-50%);
        text-transform: uppercase;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        z-index: 20;
      }

      button:hover {
        background-color: #ff4081;
        transform: translateX(-50%) scale(1.05);
      }

      .refresh-button {
        background-color: #4caf50;
      }

      .refresh-button:hover {
        background-color: #45a049;
      }
    </style>
  </head>
  <body>
    <div>
      <h1>Quiz Tonic</h1>
      <div id="selectedActivity"></div>
      <div id="fingerContainer"></div>
      <button class="refresh-button" onclick="window.location.reload();">
        Recommencer
      </button>
    </div>

    <script>
      const activitémax = [
        "telephone arabe",
        "figure accrosport",
        "As tu déjà ri du malheur de quelqu'un ?",
        "As tu déjà vomis dans un lieu public ?",
        "Meilleur anecdote de soirée",
        "Meilleur anecdote au bassin a flot",
        "Meilleur anecdote avec un bureau",
        "Meilleur anecdote avec un vélo",
        "Meilleur anecdote avec un bateau",
      ];

      const activité1 = [
        "roulade",
        "pompe à une main",
        "fait le poirier",
        "pictionnary ",
        "invente une danse",
        "raconte une histoire avec une voix aigue",
        "speech sur un objet banal",
        "présente la météo",
        "envoie un selfi ridicule à tes parents",
        "essaye de faire un tour de magie",
        "karaoké",
        "imite une personne autour de toi",
        "Quelle est ton talent chaché",
        "Quelle est le plat que tu as raté en cuisine",
        "Quelle est le cadeau le plus bizarre que tu es reçu",
        "Quelle est la pire mode que tu est suivi",
        "traverse la salle les yeux bander",
      ];

      const activité2 = [
        "invente ta rencontre avec une personne",
        "decris quelqu'un en 3 adjectif",
        "pompe avec une personne sur le dos",
        "course de chaise",
        "course de brouette",
        "concours de regard",
        "lire les message avec une personne",
        "fais une chason sur une personne",
        "reproduit la scene du titanic",
        "reproduit le portée de Dirty Dancing",
        "Changer de chaussures",
      ];

      // Utilisation d'une Map pour stocker les éléments de doigt avec leur identifiant
      const touchMap = new Map();
      let selectionTimeout;
      let selectionActive = false;
      const activityDisplay = document.getElementById("selectedActivity");
      const fingerContainer = document.getElementById("fingerContainer");

      // Ajout d'un gestionnaire pour empêcher le défilement par défaut
      fingerContainer.addEventListener(
        "touchmove",
        function (e) {
          e.preventDefault();
        },
        { passive: false }
      );

      fingerContainer.addEventListener("touchstart", handleTouchStart);
      fingerContainer.addEventListener("touchend", handleTouchEnd);
      fingerContainer.addEventListener("touchcancel", handleTouchEnd);

      function handleTouchStart(event) {
        event.preventDefault();

        // Reset la sélection si une nouvelle séquence commence
        if (touchMap.size === 0) {
          resetSelection();
        }

        // Ajouter chaque nouveau doigt
        Array.from(event.changedTouches).forEach((touch) => {
          if (!touchMap.has(touch.identifier)) {
            let rect = fingerContainer.getBoundingClientRect();
            let x = touch.clientX - rect.left;
            let y = touch.clientY - rect.top;

            let finger = document.createElement("div");
            finger.classList.add("finger");
            finger.dataset.id = touch.identifier;
            finger.style.left = `${x - 60}px`; // Centrer sur le doigt
            finger.style.top = `${y - 60}px`;

            fingerContainer.appendChild(finger);
            touchMap.set(touch.identifier, finger);
          }
        });

        // Ne démarrer le timer que si au moins un doigt est posé
        if (touchMap.size > 0 && !selectionActive) {
          clearTimeout(selectionTimeout);
          selectionTimeout = setTimeout(chooseFingers, 1500);
        }
      }

      function handleTouchEnd(event) {
        event.preventDefault();

        // Supprimer uniquement les doigts qui ont été relevés
        Array.from(event.changedTouches).forEach((touch) => {
          if (touchMap.has(touch.identifier)) {
            let finger = touchMap.get(touch.identifier);
            if (finger && fingerContainer.contains(finger)) {
              fingerContainer.removeChild(finger);
            }
            touchMap.delete(touch.identifier);
          }
        });

        // Si tous les doigts sont relevés et qu'une sélection est active, reset après 3 secondes
        if (touchMap.size === 0 && selectionActive) {
          setTimeout(resetSelection, 3000);
        }
      }

      function resetSelection() {
        selectionActive = false;
        activityDisplay.style.display = "none";

        // Supprimer tous les éléments de doigt restants
        touchMap.forEach((finger) => {
          if (fingerContainer.contains(finger)) {
            fingerContainer.removeChild(finger);
          }
        });

        touchMap.clear();
        clearTimeout(selectionTimeout);
      }

      function chooseFingers() {
        if (touchMap.size === 0) return;

        selectionActive = true;

        // Convertir la Map en tableau pour la sélection aléatoire
        const fingerElements = Array.from(touchMap.values());
        const phrase = choisirPhrase();
        const nombreDoigts = doigt(phrase);

        // Afficher l'activité sélectionnée
        activityDisplay.textContent = phrase;
        activityDisplay.style.display = "block";

        // Retirer la classe 'chosen' de tous les doigts
        fingerElements.forEach((f) => f.classList.remove("chosen"));

        // Sélectionner aléatoirement le nombre requis de doigts
        const chosen = [];
        while (
          chosen.length < nombreDoigts &&
          chosen.length < fingerElements.length
        ) {
          let index = Math.floor(Math.random() * fingerElements.length);
          if (!chosen.includes(index)) chosen.push(index);
        }

        // Appliquer la classe 'chosen' aux doigts sélectionnés
        chosen.forEach((i) => fingerElements[i].classList.add("chosen"));
      }

      function choisirPhrase() {
        let allActivities = [...activitémax, ...activité1, ...activité2];
        let randomIndex = Math.floor(Math.random() * allActivities.length);
        return allActivities[randomIndex];
      }

      function doigt(activite) {
        if (activitémax.includes(activite)) return touchMap.size; // Tous les doigts
        if (activité1.includes(activite)) return 1; // Un seul doigt
        if (activité2.includes(activite)) return 2; // Deux doigts
        return 1; // Par défaut, sélectionner un doigt
      }
    </script>
  </body>
</html>
