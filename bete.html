<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz Tonic</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #a8c0ff, #3f87a6);
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #fff;
        overflow: hidden;
        flex-direction: column;
      }

      h1 {
        font-size: 3em;
        font-weight: 700;
        text-transform: uppercase;
        text-shadow: 3px 3px 15px rgba(0, 0, 0, 0.2);
        margin-bottom: 40px;
        text-align: center;
        letter-spacing: 3px;
        position: relative;
        z-index: 10;
      }

      #fingerContainer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 0;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
        overflow: hidden;
        touch-action: none;
        z-index: 5;
      }

      .finger {
        width: 120px;
        height: 120px;
        background: linear-gradient(45deg, #ff5f6d, #ffc3a0);
        color: white;
        text-align: center;
        line-height: 120px;
        border-radius: 50%;
        font-size: 24px;
        position: absolute;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        transform: translate(-50%, -50%);
        pointer-events: none;
      }

      .chosen {
        background: linear-gradient(45deg, #cd3c15, #eb0303);
        color: #c8df45;
        box-shadow: 0 0 25px rgba(255, 0, 0, 0.8);
        transform: translate(-50%, -50%) scale(1.3);
        transition: all 0.3s ease-in-out;
      }

      button {
        padding: 15px 40px;
        font-size: 1.3em;
        background-color: #ff5f6d;
        border: none;
        border-radius: 50px;
        color: white;
        cursor: pointer;
        font-weight: 700;
        transition: all 0.3s ease;
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        text-transform: uppercase;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        z-index: 10;
      }

      button:hover {
        background-color: #ff4081;
      }

      .refresh-button {
        background-color: #4caf50;
      }

      .refresh-button:hover {
        background-color: #45a049;
      }

      #activiteDisplay {
        position: fixed;
        top: 120px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        padding: 15px 30px;
        border-radius: 10px;
        font-size: 1.5em;
        text-align: center;
        z-index: 20;
        max-width: 80%;
        display: none;
      }
    </style>
  </head>
  <body>
    <h1>Quiz Tonic</h1>
    <div id="fingerContainer"></div>
    <div id="activiteDisplay"></div>
    <button class="refresh-button" onclick="window.location.reload();">
      Recommencer
    </button>

    <script>
      const activitémax = [
        "telephone arabe",
        "figure accrosport",
        "As tu déjà ri du malheur de quelqu'un ?",
        "As tu déjà vomis dans un lieu public ?",
        "Meilleur anecdote de soirée",
        "Meilleur anecdote au bassin a flot",
        "Meilleur anecdote avec un bureau",
        "Meilleur anecdote avec un vélo",
        "Meilleur anecdote avec un bateau",
      ];

      const activité1 = [
        "roulade",
        "pompe à une main",
        "fait le poirier",
        "pictionnary ",
        "invente une danse",
        "raconte une histoire avec une voix aigue",
        "speech sur un objet banal",
        "présente la météo",
        "envoie un selfi ridicule à tes parents",
        "essaye de faire un tour de magie",
        "karaoké",
        "imite une personne autour de toi",
        "Quelle est ton talent chaché",
        "Quelle est le plat que tu as raté en cuisine",
        "Quelle est le cadeau le plus bizarre que tu es reçu",
        "Quelle est la pire mode que tu est suivi",
        "traverse la salle les yeux bander",
      ];

      const activité2 = [
        "invente ta rencontre avec une personne",
        "decris quelqu'un en 3 adjectif",
        "pompe avec une personne sur le dos",
        "course de chaise",
        "course de brouette",
        "concours de regard",
        "lire les message avec une personne",
        "fais une chason sur une personne",
        "reproduit la scene du titanic",
        "reproduit le portée de Dirty Dancing",
        "Changer de chaussures",
      ];

      // Map pour stocker les doigts et leurs positions
      const fingerElements = new Map();
      let selectionTimeout;
      let isSelecting = false;
      let isGameActive = true;
      const activiteDisplay = document.getElementById("activiteDisplay");
      const fingerContainer = document.getElementById("fingerContainer");

      // Initialiser les gestionnaires d'événements
      function initEvents() {
        fingerContainer.addEventListener("touchstart", handleTouchStart, {
          passive: false,
        });
        fingerContainer.addEventListener("touchmove", handleTouchMove, {
          passive: false,
        });
        fingerContainer.addEventListener("touchend", handleTouchEnd, {
          passive: false,
        });
        fingerContainer.addEventListener("touchcancel", handleTouchEnd, {
          passive: false,
        });
      }

      // Gérer le début du toucher
      function handleTouchStart(event) {
        event.preventDefault();

        if (!isGameActive || isSelecting) return;

        // Mettre à jour les doigts existants
        for (let i = 0; i < event.touches.length; i++) {
          const touch = event.touches[i];
          updateFingerPosition(touch);
        }

        // Réinitialiser le timer de sélection
        clearTimeout(selectionTimeout);
        if (fingerElements.size >= 1) {
          selectionTimeout = setTimeout(chooseFingers, 1500);
        }
      }

      // Gérer le mouvement du toucher
      function handleTouchMove(event) {
        event.preventDefault();

        if (!isGameActive || isSelecting) return;

        // Mettre à jour les positions des doigts
        for (let i = 0; i < event.touches.length; i++) {
          const touch = event.touches[i];
          updateFingerPosition(touch);
        }
      }

      // Gérer la fin du toucher
      function handleTouchEnd(event) {
        event.preventDefault();

        if (isSelecting) return;

        // Supprimer les doigts qui ont été retirés
        for (let i = 0; i < event.changedTouches.length; i++) {
          const touch = event.changedTouches[i];
          removeFingerElement(touch.identifier);
        }

        // Réinitialiser le timer si tous les doigts sont retirés
        if (fingerElements.size === 0) {
          clearTimeout(selectionTimeout);
        }
      }

      // Mettre à jour ou créer un élément de doigt
      function updateFingerPosition(touch) {
        const x = touch.clientX;
        const y = touch.clientY;

        let fingerElement = fingerElements.get(touch.identifier);

        if (!fingerElement) {
          fingerElement = document.createElement("div");
          fingerElement.classList.add("finger");
          fingerContainer.appendChild(fingerElement);
          fingerElements.set(touch.identifier, fingerElement);
        }

        fingerElement.style.left = `${x}px`;
        fingerElement.style.top = `${y}px`;
      }

      // Supprimer un élément de doigt
      function removeFingerElement(touchId) {
        const fingerElement = fingerElements.get(touchId);
        if (fingerElement) {
          fingerElement.remove();
          fingerElements.delete(touchId);
        }
      }

      // Choisir des doigts et afficher l'activité
      function chooseFingers() {
        if (fingerElements.size === 0 || isSelecting) return;

        isSelecting = true;

        // Sélectionner une activité en fonction du nombre de doigts
        const phrase = choisirPhrase();
        const nombreDoigts = doigt(phrase);

        console.log(`Phrase choisie : ${phrase}`);
        console.log(`Nombre de doigts requis : ${nombreDoigts}`);
        console.log(`Nombre de doigts actuels : ${fingerElements.size}`);

        // Supprimer l'état choisi de tous les doigts
        for (const fingerElement of fingerElements.values()) {
          fingerElement.classList.remove("chosen");
        }

        // Sélectionner le nombre approprié de doigts
        const fingerElementsArray = Array.from(fingerElements.values());
        let chosen = [];

        if (nombreDoigts >= fingerElementsArray.length) {
          // Si on a besoin de tous les doigts ou plus, on les sélectionne tous
          chosen = fingerElementsArray;
        } else {
          // Sinon, on sélectionne aléatoirement le nombre requis
          const indices = Array.from(
            { length: fingerElementsArray.length },
            (_, i) => i
          );
          const shuffled = indices.sort(() => 0.5 - Math.random());
          const selectedIndices = shuffled.slice(0, nombreDoigts);

          chosen = selectedIndices.map((index) => fingerElementsArray[index]);
        }

        // Appliquer la classe "chosen" aux doigts sélectionnés
        chosen.forEach((fingerElement) =>
          fingerElement.classList.add("chosen")
        );

        // Afficher l'activité
        activiteDisplay.textContent = phrase;
        activiteDisplay.style.display = "block";

        // Réinitialiser après un délai
        setTimeout(() => {
          isSelecting = false;
          isGameActive = false;

          // Attendre un peu avant de permettre un nouveau jeu
          setTimeout(() => {
            // Cacher l'activité et réinitialiser le jeu
            activiteDisplay.style.display = "none";
            isGameActive = true;

            // Supprimer tous les cercles de doigts
            for (const [touchId, fingerElement] of fingerElements.entries()) {
              fingerElement.remove();
            }
            fingerElements.clear();
          }, 5000);
        }, 2000);
      }

      // Choisir une phrase aléatoire
      function choisirPhrase() {
        const allActivities = [...activitémax, ...activité1, ...activité2];
        const randomIndex = Math.floor(Math.random() * allActivities.length);
        return allActivities[randomIndex];
      }

      // Déterminer le nombre de doigts requis pour une activité
      function doigt(activite) {
        if (activitémax.includes(activite)) return fingerElements.size; // Tous les doigts
        if (activité1.includes(activite)) return 1; // Un seul doigt
        if (activité2.includes(activite)) return 2; // Deux doigts
        return 1; // Par défaut, un doigt
      }

      // Initialiser l'application
      initEvents();
    </script>
  </body>
</html>
